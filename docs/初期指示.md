
## 概要

私は新入社員1年目。当然いろいろなツールに触れて業務を行いますが、あまりに考えなきゃいけないこと、プロセス、ルールが多すぎます。疲れます。

そして生来ミスの多い性格なので、同じミスを二度やってしまうことがあります。
まだ二度だから許されるかもしれませんが、これからもっとミスするとそろそろやばいです。

なので、ブラウザの特定種類のページで常に表示されるメモを表示するツールを作りたい。
それだけでなく、AdBlockに搭載されているような要素をセレクトして、それを押したときにポップアップするようなタイプの注意書きメモを用意できるようにしたい。

## 要求仕様

* 画面上の任意の箇所に、メモを表示することができる。
* 拡張機能の要素は、元ページのCSSに影響を受けない。
* メモを表示するページのURLは、複数のワイルドカードあるいは正規表現で指定できるようにする。
* メモの構成要素は以下の通り。（最低限です。今後あなたとのやり取りで増える・増やすかも。）
  - タイトル(optional)
  - 本文
  - フォントサイズ(optional、デフォルト設定あり)
  - 背景色(optional、デフォルト指定あり)
  - 表示するページ設定(後述します)
（今は未定だが、複数のワイルドカードを用意しているときなどは、以下の要素はそれぞれ独立させるかもしれない）
  - 画面上のX座標
  - 画面上のY座標
  - （あるいは、このUIセレクタの下に表示する！という情報）
  - 付箋のwidth、height
  - ピン止めの状態（デフォルトはOFF、OFFでfixed、ONでabsoluteのような指定方法。ピン止め前後でユーザーから見た表示位置が変わってはいけない。）
  - 最小化フラグ
  - 注意喚起機能（ホバー、クリックなど）

* 付箋をダブルクリックで編集、Ctrl+Enterあるいは保存ボタンで確定。
* 長さがあふれた場合は、Y方向はscroll。
* （ストレッチゴールとして）Markdown記法で記入できるようにしたい。その場合タイトルは不要。

メモの構成要素はこのような感じです。

* メモ下部にアイコンが並び、ピン止め、編集、コピー、背景色、フォントサイズ、削除、最小化、設定（ギアアイコン）が並んでいる。
* メモ右下にはドラッグアンドドロップしてサイズを変更できるアレが表示されている。
* ダブルクリックしない状態で、アイコンや右下のサイズボックス？以外をドラッグアンドドロップすると、画面上を移動できる。
* 最小化が有効だと、正方形のアイコンに縮む。（動作はピン止め状態に準じる）
  これもドラッグアンドドロップで移動できるほか、クリックすると再度開く。
* 設定を押すとモーダルが開き、表示するページ設定と、アクティブ化アラートの二つが設定できる。もちろんこれも元ページのCSSの影響を受けないように。

拡張機能のポップアップのページはこんな感じです。

* 新規メモを追加するボタン
* 現在のページで開いているメモの一覧と、設定されていればアクティブ化の条件の表示（メモの一覧は、ピン止めやサイズを調整できない代わりに、ジャンプボタンがある。押すとそこまでスクロールする）（設定マークを押すと、popupの中ではなくページでモーダルが出現する。そうしないとアクティブ化の条件設定ができないが、もしかしてこれって制約上無理だったりする？それだったら再検討します。)
  
* （全体の)設定画面に遷移するためのボタン


このほか、どんなサイトでも使えるようにするための考慮が必要です。
* リロードを挟まなくても実行可能
* 軽快な動作

* バックアップを取れるように。テキストやJSONなどでインポート・エクスポートできるように。

デバッグを簡単にするための機能も必要です。
* 重要度に分けたログ



### 表示するページ設定について

* メモを表示するページのURLは、複数のワイルドカードあるいは正規表現で指定できるようにする。
に関連する項目。

今私が想定しているユースケースは、Rational Team Concert(RTC)のチケット処理の際です。「これってどうすればいいっけ？」に対応するためには、どのチケット画面でもちゃんと使えるようにする必要があります。

ただそれに、簡単で分かりやすいワイルドカードか、それとも高機能で高難易度な正規表現を使うかは悩んでいます。どっちも使ってもいいんでしょうかね？

今は確定していませんが、複数のワイルドカードを設定する場合、ページAならこの座標に、ページBならこの座標がいい、みたいなことがあるかもしれません（若干の表示内容の違いで）
その場合は、座標とサイズは別々に指定できたほうが嬉しいかもしれません。


そしてその表示するページ設定をなるべく簡単にするために、履歴を読みたいなと思っています。

例えばユーザーが aaa.com/edit/*/*/*
というのを出したとき、本当にお目当てのページのみに表示されるかどうかってわからないじゃないですか。
少なくとも今表示しているサイトにその設定でマッチするかどうかをチェックするのは必須だと思いますが、それ以外のページに対してどんなタイトルのページがマッチするかを表示すれば、お眼鏡にかなった設定が簡単に導けるのではないかと思っています。

また、今のサイトにマッチする既存のページ設定がほかのメモに設定されていたら、それをデフォルトで選択するとか、候補に出すとかしたい。
（ここはちょっと検討しなければならない。都度ワイルドカード設定を作るのは面倒だからね）

ただ、履歴を取得したり、タイトルを取得するのは若干センシティブではありますので、そこは実現性含めて要チェックでしょうか。

### アクティブ化について

例えば定型的な業務があったとして、入力ボックスやボタンを一定程度ホバーしたタイミングでメモを出すとか、このボタンを一度クリックしようとしたタイミングで「本当に大丈夫？以下のことチェックした？」みたいなメモを出したい。

そのためには、Adblockerの「この要素を非表示化する」の操作のように、特定の要素を選択し、ユニークなUIセレクタで
特定のイベントが発火されたときに特定の場所に表示、あるいは強調表示するようにしたい。

イベントの種類はこんな感じですかね？このうち、実現可能性が十分にあるものだけになるのかな。現実問題。

* 特定要素を一定時間ホバー
* 特定要素の近くに i アイコンを表示。ホバーもしくはクリック
* 特定要素をクリック
* 特定input要素などをクリック


### 構成と進め方について

ある程度デカいプロジェクトでありながら、AIにすべてを任せるバイブコーディングで進めていくため、地盤固めとフローはマジで重要。

今回はGoogle Antigravityを使います。
テスト、ブラウザを用いた自動テストやコミットのルール、そこらへんとかを厳密に定義し、今日から使えるようになったっぽいAgent Skillsなども活用したい。

